{"ast":null,"code":"import _asyncToGenerator from \"/Users/constantin-bogdanbumbeneci/Desktop/Licenta/Diploma/Proiect/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Energy } from '../Entity/energy';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./plant.service\";\nexport class EnergyService {\n  constructor(plantService) {\n    this.plantService = plantService;\n    this._energies = new Array();\n    var plants = this.getPlants();\n  }\n\n  getPlants() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      (yield _this.plantService.getPlants()).forEach(p => {\n        for (let i = 0; i < p.length; i++) {\n          _this._energies.push(new Energy());\n\n          _this._energies[i].plant = p[i];\n\n          _this.plantService.fetchPlantDatasBetweenDates(p[i], '2022-01-01', '2022-12-31').subscribe(ps => {\n            _this._energies[i].status = ps;\n            ps.forEach(p => {\n              let month = p.dateTime.toString().substring(5, 7);\n              _this._energies[i].thisYearEnergy[month - 1] += p.current * p.voltage * p.powerFactor / 1000000; // Value in MWh\n            });\n            let currentMonth = new Date().toISOString().substring(5, 7);\n            let currentDay = new Date().toISOString().substring(8, 10); // let currentDay = new Date().toISOString().\n\n            for (let j = 0; j < 12; j++) {\n              if (j != currentMonth - 1) {\n                _this._energies[i].thisYearEnergy[j] *= (_this.getNoOfDaysOfMonth(j + 1) - 1) / _this.getNoOfDaysOfMonth(j + 1);\n              } else {\n                _this._energies[i].thisYearEnergy[j] *= (currentDay - 1) / currentDay;\n              }\n\n              _this._energies[i].thisYearTotalEnergy += _this._energies[i].thisYearEnergy[j];\n            }\n          }, error => console.log(error), () => {});\n\n          _this.plantService.fetchPlantDatasToday(_this._energies[i].plant).subscribe(p => {\n            // if (this._energies[i].todayCurrent.length == 0) {\n            p.forEach(v => {\n              // console.log( )\n              _this._energies[i].todayCurrent.push(v.current);\n\n              _this._energies[i].todayVoltage.push(v.voltage);\n\n              _this._energies[i].todayPowerFactor.push(v.powerFactor * 100);\n\n              _this._energies[i].todayHours.push(v.dateTime.toString().substring(11, 19));\n\n              _this._energies[i].todayPower.push(v.voltage * v.current * v.powerFactor / 1000);\n\n              _this._energies[i].todayEnergy += v.voltage * v.current * v.powerFactor / 1000;\n            });\n            _this._energies[i].todayEnergy = _this._energies[i].todayEnergy * (_this._energies[i].todayHours.length - 1) / _this._energies[i].todayHours.length; // }\n          }, error => console.log(error), () => {});\n        }\n      });\n    })();\n  }\n\n  getEnergies() {\n    return this._energies;\n  }\n\n  getNoOfDaysOfMonth(month) {\n    switch (month) {\n      case 1:\n        return 31;\n\n      case 2:\n        return 28;\n\n      case 3:\n        return 31;\n\n      case 4:\n        return 30;\n\n      case 5:\n        return 31;\n\n      case 6:\n        return 30;\n\n      case 7:\n        return 31;\n\n      case 8:\n        return 31;\n\n      case 9:\n        return 30;\n\n      case 10:\n        return 31;\n\n      case 11:\n        return 30;\n\n      case 12:\n        return 31;\n\n      default:\n        throw new Error('invalid month');\n    }\n  }\n\n}\n\nEnergyService.ɵfac = function EnergyService_Factory(t) {\n  return new (t || EnergyService)(i0.ɵɵinject(i1.PlantService));\n};\n\nEnergyService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: EnergyService,\n  factory: EnergyService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["/Users/constantin-bogdanbumbeneci/Desktop/Licenta/Diploma/Proiect/frontend/src/app/Service/energy.service.ts"],"names":["Energy","i0","i1","EnergyService","constructor","plantService","_energies","Array","plants","getPlants","forEach","p","i","length","push","plant","fetchPlantDatasBetweenDates","subscribe","ps","status","month","dateTime","toString","substring","thisYearEnergy","current","voltage","powerFactor","currentMonth","Date","toISOString","currentDay","j","getNoOfDaysOfMonth","thisYearTotalEnergy","error","console","log","fetchPlantDatasToday","v","todayCurrent","todayVoltage","todayPowerFactor","todayHours","todayPower","todayEnergy","getEnergies","Error","ɵfac","EnergyService_Factory","t","ɵɵinject","PlantService","ɵprov","ɵɵdefineInjectable","token","factory","providedIn"],"mappings":"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","sourcesContent":["import { Energy } from '../Entity/energy';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./plant.service\";\nexport class EnergyService {\n    constructor(plantService) {\n        this.plantService = plantService;\n        this._energies = new Array();\n        var plants = this.getPlants();\n    }\n    async getPlants() {\n        (await this.plantService.getPlants()).forEach(p => {\n            for (let i = 0; i < p.length; i++) {\n                this._energies.push(new Energy());\n                this._energies[i].plant = p[i];\n                this.plantService.fetchPlantDatasBetweenDates(p[i], '2022-01-01', '2022-12-31')\n                    .subscribe(ps => {\n                    this._energies[i].status = ps;\n                    ps.forEach(p => {\n                        let month = p.dateTime.toString().substring(5, 7);\n                        this._energies[i].thisYearEnergy[month - 1] += p.current * p.voltage * p.powerFactor / 1000000; // Value in MWh\n                    });\n                    let currentMonth = new Date().toISOString().substring(5, 7);\n                    let currentDay = new Date().toISOString().substring(8, 10);\n                    // let currentDay = new Date().toISOString().\n                    for (let j = 0; j < 12; j++) {\n                        if (j != currentMonth - 1) {\n                            this._energies[i].thisYearEnergy[j] *= (this.getNoOfDaysOfMonth(j + 1) - 1) / this.getNoOfDaysOfMonth(j + 1);\n                        }\n                        else {\n                            this._energies[i].thisYearEnergy[j] *= (currentDay - 1) / currentDay;\n                        }\n                        this._energies[i].thisYearTotalEnergy += this._energies[i].thisYearEnergy[j];\n                    }\n                }, error => console.log(error), () => { });\n                this.plantService.fetchPlantDatasToday(this._energies[i].plant).subscribe(p => {\n                    // if (this._energies[i].todayCurrent.length == 0) {\n                    p.forEach(v => {\n                        // console.log( )\n                        this._energies[i].todayCurrent.push(v.current);\n                        this._energies[i].todayVoltage.push(v.voltage);\n                        this._energies[i].todayPowerFactor.push(v.powerFactor * 100);\n                        this._energies[i].todayHours.push(v.dateTime.toString().substring(11, 19));\n                        this._energies[i].todayPower.push(v.voltage * v.current * v.powerFactor / 1000);\n                        this._energies[i].todayEnergy += v.voltage * v.current * v.powerFactor / 1000;\n                    });\n                    this._energies[i].todayEnergy = this._energies[i].todayEnergy * (this._energies[i].todayHours.length - 1) / this._energies[i].todayHours.length;\n                    // }\n                }, error => console.log(error), () => { });\n            }\n        });\n    }\n    getEnergies() {\n        return this._energies;\n    }\n    getNoOfDaysOfMonth(month) {\n        switch (month) {\n            case 1: return 31;\n            case 2: return 28;\n            case 3: return 31;\n            case 4: return 30;\n            case 5: return 31;\n            case 6: return 30;\n            case 7: return 31;\n            case 8: return 31;\n            case 9: return 30;\n            case 10: return 31;\n            case 11: return 30;\n            case 12: return 31;\n            default: throw new Error('invalid month');\n        }\n    }\n}\nEnergyService.ɵfac = function EnergyService_Factory(t) { return new (t || EnergyService)(i0.ɵɵinject(i1.PlantService)); };\nEnergyService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: EnergyService, factory: EnergyService.ɵfac, providedIn: 'root' });\n"]},"metadata":{},"sourceType":"module"}